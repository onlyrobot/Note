# 操作系统

## 计算机系统

### 组成

* 应用软件
* 实用软件
* 操作系统
* 硬件

## 操作系统的定义和设计目标

操作系统是由一系列程序模块组成的一个大的系统管理程序。目的是向用户提供便捷的操作环境和高效利用硬件资源

## 操作系统的发展历史

### 顺序处理阶段（手工操作阶段，没有操作系统或者说人就是操作系统）

### 简单批处理系统（监控程序来控制执行流程）

分为联机批处理系统和脱机批处理系统，二者区别在于脱机批处理系统用卫星机来将程序加载到磁带和将磁带数据输出到打印机。

### 多道批处理系统（在批处理基础上用多道的概念进一步提升CPU运行效率）

衡量批处理计算机系统性能指标有

* 资源利用率：硬件资源被使用的时间/工作总时间
* 吞吐量：单位时间系统处理的信息量，常用单位时间处理的作业数量来表示
* 周转时间：作业从加载到完成所使用的总时间，常用的是平均周转时间

### 分时系统（多个用户同时共享计算机资源）

解决了批处理系统的不能控制作业运行和简单任务平均周转时间过长的问题。采用的方式是将一段时间分成若干时间片，这些时间片可以分配给多个总端机器同时使用。分时系统的特点如下：

* 同时性：同时使用计算机
* 独立性：各个用户之间互不干扰
* 交互性：用户终端可以输入控制工作的命令，系统终端并处理这些控制信息，然后将结果输出，形成一问一答的方式来运行程序。
* 及时性：指的是用户能在较短时间内获得系统的响应

## 实时系统（以消息事件为对象能够及时对它们的请求相应）

实时系统能够对随机发生的外部事件做出及时的响应和处理，这里的及时指的是系统对特定的输入作出反应的速度足以控制发出实时信号的那个设备。实时系统的主要特点是：

* 实时性：
* 可靠性：具有容错能力，往往采用双工机制，一台作为主机一台作为后备机与主机并行运行。
* 确定性：可确定性主要取决于系统响应中断的速度，其次取决于系统是否有足够的能力在要求的时间内处理完指定的请求。实时性与确定性密切相关。

实时系统的功能主要为：

* 实时时钟管理
* 简单人机对话
* 过载处理

### 嵌入式系统（针对特定功能，对计算机功能相应裁剪得到的系统）

## 操作系统的功能

* 处理机管理
* 存储管理
* 设备管理
* 文件管理

## 操作系统的服务

* 用户接口
* 执行程序
* I/O操作
* 文件系统操作
* 通信服务
* 错误检测和处理
* 资源分配
* 记账：不断统计各个用户程序占有的系统资源情况，防止故障程序的运行，使系统有效工作
* 保护：在多用户系统中控制每个用户的资源访问，保证资源状态一致性

## 操作系统的特性

* 并发性
* 共享性
* 虚拟性
* 异步性

## 操作系统的进一步发展

### 多处理机系统

实现了共享主存和并行计算，具体可分为：

* 非对称多处理：通常指一个处理机运行操作系统其他处理机运行作业
* 对称多处理：程序可以被安排在一个处理机上运行也可以多个处理机上同时运行，因此相对而言增加了系统的吞吐率和可靠性。

### 网络操作系统

利用网络上具有计算能力的闲时计算机，通过一定的管理方式让计算机之间互相通信和交换信息。网络操作系统包括的主要功能包括：

* 提高高效、可靠的网络通信能力
* 提供多种网络服务

根据结构的不同又可以划分为客户/服务器模式（Client/Server）和对等模式（Peer-to-peer）

### 分布式操作系统

分布式操作系统是多机系统的一种新形式，它强调资源、任务、功能和控制的全面分布。其基本特征是：

* 软硬件模块具有模块性
* 工作方式上具有自洽性
* 系统功能上具有协同并行性
* 对用户具有透明性
* 系统的容错性和坚固性

## 操作系统和用户的接口

* 命令行
* 图形界面

## 系统调用接口

CPU有两种操作方式，分别是用户态（目态）和核心态（管理态）。不同的态决定能够运行的指令。一般来说涉及到设备的访问和修改都是核心态才具有的权限。

系统提供了丰富的调用接口让用户来调用：

* 进程控制：包括程序的正常、异常终止，程序装入、执行，进程创建、删除，得到进程的属性、分配和释放内存以及进程之间的同步和通信等。
* 文件管理：控制文件的操作
* 设备管理：管理设备的读写修改等
* 其他服务：如时间获取、发送接收消息等

系统调用的执行流程：用户调用系统接口后通过陷入（异常）让CPU由用户态转到核心态、然后执行系统的接口程序，执行完后返回结果并回到用户态。具体过程如下：

* 通过陷入（异常）使系统切换到核心态
* 将程序计数器和处理及的当前状态存入任务的堆栈中
* 将系统**调用号**存入核心堆栈中
* 执行汇编代码来保存通用寄存器的内容
* 调用相应的操作系统历程来完成系统调用
* 返回到用户方式

## 操作系统的设计规范

* 系统效率
* 系统可靠性

1. 可靠性R（Reliability）：平均无故障时间
2. 可维护性S（Seviceability）：平均故障修复时间
3. 可用性A（Availability）：系统能够正常运行的概率

* 可移植性：指的是将系统安装到其他设备需要修改代码的量
* 可伸缩性：指的是系统对新设备添加的兼容程度
* 兼容性：指系统对其他系统的软件或该系统早期版本的软件兼容程度
* 安全性：

操作系统结构设计

* 单块式的简单结构

简单，但是由于不具备整体设计性所以会在使用过程中出现很多问题

* 层次式的结构设计

模块的层级细分，功能的层级调用，从而实现整个操作系统的功能

* 基于微内核的client/server的设计

为了应对日益庞大的内核带来的管理维护困难，微内核的主要目的是提供操作系统最基本的功能，然后通过通信的方式然client程序和server程序之间进行通信。这样做可以方便日后的功能拓展和更为安全可靠。

## 进程

进程指的是程序的一次执行过程，是操作系统管理进行资源调度的重要方式。为了实现这一过程的正确进行需要下面的相关结构和控制规则

* 进程控制块(Process Control Block, PCB)
* 进程的状态以及状态间的转化规则
* 进程间的组织关系
* 控制进程的相关原语
* 处理机的调度级别和功能
* 具体进程调度的方式、流程和算法

## 线程

线程表示程序可能的子任务的执行过程，同样为了实现进程的控制需要引入相关结构和状态转移规则

## 进程间的并发控制和死锁

由于**临界资源**和进程间**协作**的存在，需要对进程的运行进行一定的控制，这个具体需要控制的情况有进程互斥、进程同步。其中比较经典的问题有**生产者和消费者问题**和**读者与写者问题**。

<!-- TODO： -->
